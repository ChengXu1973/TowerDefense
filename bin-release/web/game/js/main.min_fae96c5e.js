var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,a){return new(i||(i=Promise))(function(n,r){function s(t){try{h(a.next(t))}catch(e){r(e)}}function o(t){try{h(a["throw"](t))}catch(e){r(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,o)}h((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(a){i=[6,a],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.hash=com.StringUtil.getUUID(),t}return __extends(i,e),i.prototype.start=function(){t.TickManager.getInstance().addTicker(this,1)},i.prototype.clear=function(){t.TickManager.getInstance().removeTicker(this.hash)},i.prototype.update=function(t){this.updatePos(),this.updateDisplay(),this.checkNeedClear()},i.prototype.initBullet=function(e,i,a,n,r){this.level=i,this.type=e,this.needClear=!1,this.target=r,this.hitRange=t.Bullet.getHitRange(this.type,this.level),this.debuff=t.Bullet.getDebuff(this.type,this.level),this.velocity=t.Bullet.getVelocity(this.type,this.level),this.x=a,this.y=n,this.direction=egret.Point.create(0,0);var s=t.TickManager.getInstance().getTicker(r);if(s){var o=s.x-a,h=s.y-n,l=Math.sqrt(o*o+h*h);l>0&&(this.direction=egret.Point.create(o/l,h/l))}this.initDisplay(),this.start()},i.prototype.hit=function(){},i.prototype.updatePos=function(){this.velocity&&(this.x+=this.velocity*this.direction.x*t.GlobalData.size/60,this.y+=this.velocity*this.direction.y*t.GlobalData.size/60)},i.prototype.checkNeedClear=function(){(this.x+this.width<=0||this.y+this.height<=0||this.x+this.width>1920||this.y+this.height>1080)&&(this.needClear=!0)},i.prototype.initDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size},i.prototype.updateDisplay=function(){},i}(egret.Sprite);t.BaseBullet=e,__reflect(e.prototype,"game.BaseBullet",["game.ITicker"])}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.hash=com.StringUtil.getUUID(),i.hpBar=t.HPBarPool.getInstance().getItem(),i}return __extends(i,e),i.prototype.start=function(){t.TickManager.getInstance().addTicker(this,2)},i.prototype.clear=function(){t.TickManager.getInstance().removeTicker(this.hash),this.initEnemy(),this._path=[],this.hpBar.setVisible(!1)},i.prototype.update=function(t){this._now=t,this.updatePosition(),this.executeDebuff(),this.currentHP>0?this.updateDisplay():this.clear()},i.prototype.initPath=function(e){var i=JSON.parse(JSON.stringify(e));this._path=i,this.x=this._path[0][0]*t.GlobalData.size,this.y=this._path[0][1]*t.GlobalData.size,this.node=0},i.prototype.initEnemy=function(){this._speed=t.Enemy.getSpeed(this.type),this.totalHP=t.Enemy.getHP(this.type),this.area=t.Enemy.getArea(this.type),this.currentHP=this.totalHP,this.hpBar.setHP(this.totalHP,this.currentHP),this._debuffs=[],this._history=[],this._damageBonus=1,this.setDisplay(),this.hpBar.x=0,this.hpBar.y=0,this.addChild(this.hpBar),this.node=0},i.prototype.hit=function(t,e){if(void 0===e&&(e=!0),!(this._history.indexOf(t.hash)>-1)){e&&this._history.push(t.hash+"");var i=JSON.parse(JSON.stringify(t.debuff));this.addDebuff(i)}},i.prototype.addDebuff=function(t){var e=this;t.forEach(function(t){t.effectTime=e._now}),this._debuffs=this._debuffs.concat(t),this._debuffs.sort(function(t,e){return t.type-e.type})},i.prototype.updatePosition=function(){if(isNaN(this.x)&&(this.x=this._path[0][0]*t.GlobalData.size),isNaN(this.y)&&(this.y=this._path[0][1]*t.GlobalData.size),this.node!=this._path.length-1){var e=this.node,i=this._path[e],a=this._path[e+1],n=egret.Point.create((a[0]-i[0])/(Math.abs(a[0]-i[0])||1),(a[1]-i[1])/(Math.abs(a[1]-i[1])||1)),r=this._speed*this._decelerate;this.x+=r*n.x*t.GlobalData.size,this.y+=r*n.y*t.GlobalData.size;var s=(a[0]*t.GlobalData.size-this.x)*n.x+(a[1]*t.GlobalData.size-this.y)*n.y;0>=s&&(this.x=a[0]*t.GlobalData.size,this.y=a[1]*t.GlobalData.size,this.node=e+1),this.node==this._path.length-1&&this.dispatchEventWith(t.GameEvent.EnemyClear,!0,this.hash)}},i.prototype.executeDebuff=function(){this._damageBonus=1,this._decelerate=1;for(var e=!1,i=this._debuffs.length-1,a=i;a>=0;a--){var n=this._debuffs[a];if(n){switch(n.type){case 0:this.currentHP-=n.value*this._damageBonus,e=!0;break;case 1:this.currentHP-=16.7*n.value*this._damageBonus/n.time,e=!0;break;case 2:this._decelerate*=n.value;break;case 3:this._decelerate=0;break;case 4:this._damageBonus*=n.value}this._now-n.effectTime>=n.time&&this._debuffs.splice(a,1),this.currentHP=Math.max(0,this.currentHP),e&&(this.hpBar.setHP(this.totalHP,this.currentHP),this.hpBar.setVisible()),0==this.currentHP&&this.dispatchEventWith(t.GameEvent.EnemyClear,!0,this.hash)}}},i.prototype.setDisplay=function(){},i.prototype.updateDisplay=function(){},i}(egret.Sprite);t.BaseEnemy=e,__reflect(e.prototype,"game.BaseEnemy",["game.ITicker","game.ILife"])}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.hash=com.StringUtil.getUUID(),t}return __extends(i,e),i.prototype.start=function(){t.TickManager.getInstance().addTicker(this,0)},i.prototype.clear=function(){t.TickManager.getInstance().removeTicker(this.hash)},i.prototype.update=function(t){this.cd-=16.7,this.cd=Math.max(0,this.cd),this.target&&this.cd<=0&&this.generateBullet(t)},i.prototype.initTower=function(t){this.cd=0,this.target="",this.type=t,this.level=0,this.setDisplay()},i.prototype.upgrade=function(){switch(this.level){case 0:this.level=1;break;case 1:case 2:this.level=2}this.cd=0,this.setDisplay()},i.prototype.generateBullet=function(e){this.dispatchEventWith(t.GameEvent.CreateBullet,!0,{type:this.type,level:this.level,startX:this.x,startY:this.y,target:this.target}),this.cd=t.Bullet.getCD(this.type,this.level)},i.prototype.setDisplay=function(){},i}(egret.Sprite);t.BaseTower=e,__reflect(e.prototype,"game.BaseTower",["game.ITicker"])}(game||(game={}));var game;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i.data=e.data||null,i.once(eui.UIEvent.COMPLETE,i.uiComplete,i),i.once(eui.UIEvent.REMOVED_FROM_STAGE,i.dispose,i),i.skinName="resource/game_ui/"+e.name+"Skin.exml",i}return __extends(e,t),e.prototype.uiComplete=function(){this.initData(),this.initUI(),this.initEvent(!0)},e.prototype.initData=function(){},e.prototype.initEvent=function(t){},e.prototype.initUI=function(){},e.prototype.dispose=function(){this.initEvent(!1)},e}(eui.Component);t.BaseScene=e,__reflect(e.prototype,"game.BaseScene")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.initTower(2),i.range=2*t.GlobalData.size,i}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(65,65,12929577);e.x=25,e.y=25,this.addChild(e)},i}(t.BaseTower);t.Tower_2=e,__reflect(e.prototype,"game.Tower_2")}(game||(game={}));var com;!function(t){var e=function(){function t(){}return t.sortPoints=function(t,e){switch(void 0===e&&(e=0),e){case 0:return t.sort(function(t,e){return t.x!=e.x?t.x-e.x:t.y-e.y});case 1:return t.sort(function(t,e){return t.y!=e.y?t.y-e.y:t.x-e.x})}},t.shuffle=function(t){for(var e=t.length-1;e>=0;e--){var i=Math.floor(Math.random()*(e+1)),a=t[i];t[i]=t[e],t[e]=a}return t},t.distinct=function(t){if(Array.isArray(t)&&t.length>0){for(var e={},i=t.length,a=0;i>a;a+=1)e[t[a]]=t[a];return Object.keys(e)}return[]},t}();t.ArrayUtil=e,__reflect(e.prototype,"com.ArrayUtil")}(com||(com={}));var com;!function(t){var e=function(){function t(){}return t.getDistance=function(t,e,i,a){return Math.sqrt((t-e)*(t-e)+(i-a)*(i-a))},t}();t.NumberUtil=e,__reflect(e.prototype,"com.NumberUtil")}(com||(com={}));var com;!function(t){var e=function(){function t(){}return t.getUUID=function(t,e){void 0===t&&(t=8),void 0===e&&(e=16);var i,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(e=e||a.length,t)for(i=0;t>i;i++)n[i]=a[0|Math.random()*e];else{var r;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",i=0;36>i;i++)n[i]||(r=0|16*Math.random(),n[i]=a[19==i?3&r|8:r])}return n.join("")},t.checkNameValid=function(t){var e=new RegExp(/^[A-Za-z0-9\u4e00-\u9fa5]+$/);return e.test(t)},t.getStrLen=function(t){for(var e=0,i=0;i<t.length;i++){var a=t.charCodeAt(i);a>=1&&126>=a||a>=65376&&65439>=a?e++:e+=2}return e},t.sliceByLen=function(t,e,i){void 0===i&&(i=0);for(var a="",n=0,r=i;r<t.length;r++){var s=t.charCodeAt(r);s>=1&&126>=s||s>=65376&&65439>=s?n++:n+=2,e>=n&&(a+=t[r])}return a},t.sliceByLen2=function(t,e,i){void 0===i&&(i=0);var a=this.sliceByLen(t,e,i);return a!=t&&(a+="..."),a},t.checkMail=function(t){var e=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return e.test(t)?!0:!1},t.getUrlParam=function(t){for(var e=t.indexOf("?"),i=t.substr(e+1),a=i.split("&"),n={},r=0;r<a.length;r++){var s=a[r].split("=");n[s[0]]=s[1]}return n},t}();t.StringUtil=e,__reflect(e.prototype,"com.StringUtil")}(com||(com={}));var game;!function(t){var e=function(e){function i(){var a=e.call(this)||this;return a.delay=1500,a.touchEnabled=!1,a.width=t.GlobalData.size,a.height=t.GlobalData.size,a.alpha=0,a.totalBar=new eui.Rect(i.barW,i.barH,15218744),a.totalBar.x=(t.GlobalData.size-i.barW)/2,a.totalBar.y=10,a.addChild(a.totalBar),a.currentBar=new eui.Rect(i.barW,i.barH,11645750),a.currentBar.x=(t.GlobalData.size-i.barW)/2,a.currentBar.y=10,a.addChild(a.currentBar),a}return __extends(i,e),i.prototype.setHP=function(t,e){this.currentBar.width=e*i.barW/t},i.prototype.setVisible=function(t){var e=this;return void 0===t&&(t=!0),this.timeSign&&clearTimeout(this.timeSign),t?(this.alpha=1,void(this.timeSign=setTimeout(function(){e.alpha=0},this.delay))):void(this.alpha=0)},i.prototype.clear=function(){this.timeSign&&clearTimeout(this.timeSign)},i.barW=45,i.barH=6,i}(egret.Sprite);t.HPBar=e,__reflect(e.prototype,"game.HPBar")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._data=t,i.hash=com.StringUtil.getUUID(),i.addEventListener(eui.UIEvent.COMPLETE,i.uiComplete,i),i.addEventListener(eui.UIEvent.REMOVED_FROM_STAGE,i.clear,i),i.skinName="resource/game_ui/component/LevelSkin.exml",i}return __extends(i,e),i.prototype.uiComplete=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiComplete,this),this.initListener(!0),this.initLevel(),this.start()},i.prototype.start=function(){t.TickManager.getInstance().addTicker(this,0)},i.prototype.update=function(t){this._ts++,this.checkBullets(),this.checkHits(),this.checkTowerRange(),this.generateEnemy()},i.prototype.clearAllEnemy=function(){for(var e=this._enemys.length-1;e>=0;e--){var i=this._enemys[e];i.node==this._path.length-1,this._enemys.splice(e,1),this.groupEnemy.removeChild(i),t.EnemyPool.getInstance().storeItem(i)}if(0==this._enemys.length&&0==this._enemyTs.length){if(this._wave++,this._wave>this._data.round)return t.TickManager.getInstance().stopTick(),void alert("done!");for(var a=Math.ceil(this._data.enemyNum*Math.pow(1.2,this._wave)),e=0;a>e;e++)this._enemyTs.push(30*(e+1)+this._ts);this._enemyTs.sort(function(t,e){return t-e})}},i.prototype.freezeAllEnemy=function(){for(var t=0;t<this._enemys.length;t++){var e=this._enemys[t];e&&e.addDebuff([{type:3,time:2e3,value:0}])}},i.prototype.initLevel=function(){this._wave=1,this._ts=0,this._towers={},this._pathArea=[],this._enemys=[],this._bullets=[],this._enemyTs=[],this._path=this._data.path;for(var e=0;e<this._path.length-1;e++){var i=this._path[e],a=this._path[e+1],n=a[0]-i[0],r=a[1]-i[1];if(0==n)for(var s=a[0],o=Math.max(i[1],a[1]),h=Math.min(i[1],a[1]),l=h;o>=l;l++){var c=new eui.Rect(t.GlobalData.size,t.GlobalData.size,4473924);c.x=s*t.GlobalData.size,c.y=l*t.GlobalData.size,this.groupPath.addChild(c),this._pathArea.push("path_"+s+"_"+l)}if(0==r)for(var l=a[1],o=Math.max(i[0],a[0]),h=Math.min(i[0],a[0]),s=h;o>=s;s++){var c=new eui.Rect(t.GlobalData.size,t.GlobalData.size,4473924);c.x=s*t.GlobalData.size,c.y=l*t.GlobalData.size,this.groupPath.addChild(c),this._pathArea.push("path_"+s+"_"+l)}}this._pathArea=com.ArrayUtil.distinct(this._pathArea);for(var e=0;e<this._data.defaultTower.length;e++){var u=this._data.defaultTower[e];this.addTower(u)}for(var p=this._data.enemyNum,e=0;p>e;e++)this._enemyTs.push(30*(e+1));this._enemyTs.sort(function(t,e){return t-e}),this.groupAddTower.visible=!1,this.groupEditTower.visible=!1},i.prototype.checkBullets=function(){for(var e=this._bullets.length-1;e>=0;e--){var i=this._bullets[e];i.needClear&&(this._bullets.splice(e,1),this.groupBullet.removeChild(i),t.BulletPool.getInstance().storeItem(i))}},i.prototype.checkHits=function(){for(var t=this._enemys.length-1;t>=0;t--)for(var e=this._enemys[t],i=this._bullets.length-1;i>=0;i--){var a=this._bullets[i],n=com.NumberUtil.getDistance(a.x,e.x,a.y,e.y);n<=a.hitRange+e.area&&(e.hit(a),a.hit())}},i.prototype.checkTowerRange=function(){for(var e in this._towers){var i=this._towers[e];if(i.target){var a=t.TickManager.getInstance().getTicker(i.target);if(a){var n=com.NumberUtil.getDistance(a.x,i.x,a.y,i.y);n>=a.area+i.range&&(i.target="")}else i.target=""}else{for(var r=[],s=this._enemys.length-1;s>=0;s--){var a=this._enemys[s],n=com.NumberUtil.getDistance(a.x,i.x,a.y,i.y);n<a.area+i.range&&r.push(a)}r.length&&(r.sort(function(t,e){return t.node-e.node}),i.target=r[r.length-1].hash)}}},i.prototype.generateEnemy=function(){if(this._enemyTs[0]<=this._ts){var e=~~((this._data.enemy.length-.01)*Math.random()),i=this._data.enemy[e],a=t.EnemyPool.getInstance().getItem(i);this.groupEnemy.addChild(a),this._enemys.push(a),a.initPath(this._path),a.start(),this._enemyTs.shift()}},i.prototype.getTower=function(t,e){var i="tower_"+t+"_"+e,a=this._towers[i]||null;return a},i.prototype.addTower=function(e){for(var i=t.TowerPool.getInstance().getItem(e.type),a=0;a<e.level-1;a++)i.upgrade();i.x=e.pos[0]*t.GlobalData.size,i.y=e.pos[1]*t.GlobalData.size;var n="tower_"+e.pos[0]+"_"+e.pos[1];this._towers[n]=i,this.groupTower.addChild(i),i.start()},i.prototype.removeTower=function(e,i){var a="tower_"+e+"_"+i,n=this._towers[a]||null;n&&(this.groupTower.removeChild(n),t.TowerPool.getInstance().storeItem(n),delete this._towers[a])},i.prototype.initListener=function(e){e?(this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.handleTouch,this),this.addEventListener(t.GameEvent.CreateBullet,this.createBullet,this),this.addEventListener(t.GameEvent.EnemyClear,this.clearEnemy,this)):(this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.handleTouch,this),this.removeEventListener(t.GameEvent.CreateBullet,this.createBullet,this),this.removeEventListener(t.GameEvent.EnemyClear,this.clearEnemy,this))},i.prototype.handleTouch=function(t){switch(t.target){case this.rectAddTower:this.groupAddTower.visible=!1;break;case this.rectEditTower:this.groupEditTower.visible=!1;break;case this.rectTouchArea:this.touchRect(t);break;case this.btnUpgradeTower:var e=this.getTower(this._touchPos.x,this._touchPos.y);e.upgrade(),this.groupEditTower.visible=!1;break;case this.btnDeleteTower:this.removeTower(this._touchPos.x,this._touchPos.y),this.groupEditTower.visible=!1;break;default:var i=[this.btnAddTower0,this.btnAddTower1,this.btnAddTower2,this.btnAddTower3,this.btnAddTower4,this.btnAddTower5].indexOf(t.target);if(i>-1){var a={type:i,level:0,pos:[this._touchPos.x,this._touchPos.y]};return this.addTower(a),void(this.groupAddTower.visible=!1)}}},i.prototype.touchRect=function(e){var i=e.localX,a=e.localY,n=Math.floor(i/t.GlobalData.size),r=Math.floor(a/t.GlobalData.size);if(!(this._pathArea.indexOf("path_"+n+"_"+r)>-1)){this._touchPos=egret.Point.create(n,r);var s=this.getTower(n,r);return s?(this.btnUpgradeTower.enabled=2!=s.level,void(this.groupEditTower.visible=!0)):void(this.groupAddTower.visible=!0)}},i.prototype.createBullet=function(e){var i=e.data,a=t.BulletPool.getInstance().getItem(i.type);if(a.initBullet(i.type,i.level,i.startX,i.startY,i.target),i.target){var n=t.TickManager.getInstance().getTicker(i.target);if(!n)return void t.BulletPool.getInstance().storeItem(a)}this.groupBullet.addChild(a),this._bullets.push(a),a.start()},i.prototype.clearEnemy=function(e){for(var i=e.data,a=this._enemys.length-1;a>=0;a--){var n=this._enemys[a];n.hash==i&&(n.node==this._path.length-1,this._enemys.splice(a,1),this.groupEnemy.removeChild(n),t.EnemyPool.getInstance().storeItem(n))}if(0==this._enemys.length&&0==this._enemyTs.length){if(this._wave++,this._wave>this._data.round)return t.TickManager.getInstance().stopTick(),void alert("done!");for(var r=Math.ceil(this._data.enemyNum*Math.pow(1.2,this._wave)),a=0;r>a;a++)this._enemyTs.push(30*(a+1)+this._ts);this._enemyTs.sort(function(t,e){return t-e})}},i.prototype.clear=function(){t.TickManager.getInstance().removeTicker(this.hash),this.removeEventListener(eui.UIEvent.REMOVED_FROM_STAGE,this.clear,this),this.initListener(!1)},i}(eui.Component);t.Level=e,__reflect(e.prototype,"game.Level",["game.ITicker"])}(game||(game={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function a(a){e.call(i,a,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?a(n):RES.getResAsync(t,a,this)}else RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.hit=function(){this.needClear=!0},i.prototype.initDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(5,5,0);e.x=55,e.y=55,this.addChild(e)},i.prototype.updateDisplay=function(){},i}(t.BaseBullet);t.Bullet_0=e,__reflect(e.prototype,"game.Bullet_0")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.hit=function(){this.needClear=!0},i.prototype.initDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(15,15,0);e.x=50,e.y=50,this.addChild(e)},i.prototype.updateDisplay=function(){},i}(t.BaseBullet);t.Bullet_1=e,__reflect(e.prototype,"game.Bullet_1")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.width=t.GlobalData.size,i.height=t.GlobalData.size,i.shape=new egret.Shape,i.shape.alpha=0,i.shape.x=t.GlobalData.size/2,i.shape.y=t.GlobalData.size/2,i.shape.graphics.beginFill(957093,1),i.shape.graphics.drawCircle(t.GlobalData.size/2,t.GlobalData.size/2,t.GlobalData.size/2),i.shape.graphics.endFill(),i.addChild(i.shape),i}return __extends(i,e),i.prototype.hit=function(){},i.prototype.initDisplay=function(){this.hitRange=0,this.shape.alpha=0,this.shape.x=t.GlobalData.size/2,this.shape.y=t.GlobalData.size/2,this.shape.scaleX=1,this.shape.scaleY=1},i.prototype.initBullet=function(t,i,a,n,r){e.prototype.initBullet.call(this,t,i,a,n,r),this.hitRange=1},i.prototype.clear=function(){e.prototype.clear.call(this),this.initDisplay()},i.prototype.updateDisplay=function(){this.hitRange+=t.GlobalData.size/60,this.shape.alpha=Math.max((2*t.GlobalData.size-this.hitRange)/(2*t.GlobalData.size),0),this.shape.scaleX=this.hitRange/t.GlobalData.size,this.shape.scaleY=this.hitRange/t.GlobalData.size,this.shape.x=(t.GlobalData.size-this.hitRange)/2,this.shape.y=(t.GlobalData.size-this.hitRange)/2},i.prototype.checkNeedClear=function(){this.hitRange>=2*t.GlobalData.size&&(this.needClear=!0)},i}(t.BaseBullet);t.Bullet_2=e,__reflect(e.prototype,"game.Bullet_2")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.hit=function(){this.needClear=!0},i.prototype.initDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(10,10,1414130);e.x=52,e.y=52,this.addChild(e)},i.prototype.updateDisplay=function(){},i}(t.BaseBullet);t.Bullet_3=e,__reflect(e.prototype,"game.Bullet_3")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.hit=function(){this.needClear=!0},i.prototype.initDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(10,10,15952699);e.x=52,e.y=52,this.addChild(e)},i.prototype.updatePos=function(){var e=t.TickManager.getInstance().getTicker(this.target);if(e){var i=e.y-this.y,a=e.x-this.x,n=Math.sqrt(a*a+i*i);n>0?this.direction=egret.Point.create(a/n,i/n):this.direction=egret.Point.create(0,0)}this.velocity&&(this.x+=this.velocity*this.direction.x*t.GlobalData.size/60,this.y+=this.velocity*this.direction.y*t.GlobalData.size/60)},i.prototype.updateDisplay=function(){},i}(t.BaseBullet);t.Bullet_4=e,__reflect(e.prototype,"game.Bullet_4")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.width=t.GlobalData.size,i.height=t.GlobalData.size,i.shape=new egret.Shape,i.shape.alpha=0,i.shape.x=t.GlobalData.size/2,i.shape.y=t.GlobalData.size/2,i.shape.graphics.beginFill(15668551,1),i.shape.graphics.drawCircle(t.GlobalData.size/2,t.GlobalData.size/2,t.GlobalData.size/2),i.shape.graphics.endFill(),i.addChild(i.shape),i}return __extends(i,e),i.prototype.hit=function(){},i.prototype.initDisplay=function(){this.hitRange=0,this.shape.alpha=0,this.shape.x=t.GlobalData.size/2,this.shape.y=t.GlobalData.size/2,this.shape.scaleX=1,this.shape.scaleY=1},i.prototype.initBullet=function(t,i,a,n,r){e.prototype.initBullet.call(this,t,i,a,n,r),this.hitRange=1},i.prototype.clear=function(){e.prototype.clear.call(this),this.initDisplay()},i.prototype.updateDisplay=function(){this.hitRange+=t.GlobalData.size/60,this.shape.alpha=Math.max((1.5*t.GlobalData.size-this.hitRange)/(1.5*t.GlobalData.size),0),this.shape.scaleX=this.hitRange/t.GlobalData.size,this.shape.scaleY=this.hitRange/t.GlobalData.size,this.shape.x=(t.GlobalData.size-this.hitRange)/2,this.shape.y=(t.GlobalData.size-this.hitRange)/2},i.prototype.checkNeedClear=function(){this.hitRange>=1.5*t.GlobalData.size&&(this.needClear=!0)},i}(t.BaseBullet);t.Bullet_5_Splash=e,__reflect(e.prototype,"game.Bullet_5_Splash")}(game||(game={}));var game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.hit=function(){this.needClear=!0,this.debuff=[],this.dispatchEventWith(t.GameEvent.CreateBullet,!0,{type:6,level:this.level,startX:this.x,startY:this.y,target:""})},i.prototype.initDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(10,10,15668551);e.x=52,e.y=52,this.addChild(e)},i.prototype.updateDisplay=function(){},i}(t.BaseBullet);t.Bullet_5=e,__reflect(e.prototype,"game.Bullet_5")}(game||(game={}));var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload")];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var a=new eui.Theme("resource/default.thm.json",t.stage);a.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){game.ScenesManager.getInstance().addToStage(this.stage),game.ScenesManager.getInstance().initUIScene(game.Scenes.EDITUI)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.type=0,t.initEnemy(),t}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(25,25,11082602);e.x=45,e.y=45,this.addChild(e)},i.prototype.updateDisplay=function(){},i}(t.BaseEnemy);t.Enemy_0=e,__reflect(e.prototype,"game.Enemy_0")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.type=1,t.initEnemy(),t}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(15,15,15887418);e.x=50,e.y=50,this.addChild(e)},i.prototype.updateDisplay=function(){},i}(t.BaseEnemy);t.Enemy_1=e,__reflect(e.prototype,"game.Enemy_1")}(game||(game={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.initTower(0),i.range=3*t.GlobalData.size,i}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(65,65,2593942);e.x=25,e.y=25,this.addChild(e)},i}(t.BaseTower);t.Tower_0=e,__reflect(e.prototype,"game.Tower_0")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.initTower(1),i.range=2*t.GlobalData.size,i}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(65,65,15288668);e.x=25,e.y=25,this.addChild(e)},i}(t.BaseTower);t.Tower_1=e,__reflect(e.prototype,"game.Tower_1")}(game||(game={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=1920,this.textField.height=100,this.textField.textAlign="center",this.textField.text="Loading..."},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.initTower(3),i.range=3*t.GlobalData.size,i}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(65,65,1414130);e.x=25,e.y=25,this.addChild(e)},i}(t.BaseTower);t.Tower_3=e,__reflect(e.prototype,"game.Tower_3")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.initTower(4),i.range=2*t.GlobalData.size,i}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(65,65,15952699);e.x=25,e.y=25,this.addChild(e)},i}(t.BaseTower);t.Tower_4=e,__reflect(e.prototype,"game.Tower_4")}(game||(game={}));var game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.initTower(5),i.range=2*t.GlobalData.size,i}return __extends(i,e),i.prototype.setDisplay=function(){this.width=t.GlobalData.size,this.height=t.GlobalData.size;var e=new eui.Rect(65,65,15668551);e.x=25,e.y=25,this.addChild(e)},i}(t.BaseTower);t.Tower_5=e,__reflect(e.prototype,"game.Tower_5")}(game||(game={}));var game;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getIpInfo=function(){return window.ipInfo?window.ipInfo:null},e}(egret.EventDispatcher);t.GameController=e,__reflect(e.prototype,"game.GameController")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t}();t.LevelData=e,__reflect(e.prototype,"game.LevelData");var i=function(){function t(){}return t}();t.TowerPosition=i,__reflect(i.prototype,"game.TowerPosition")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t.getHitRange=function(t,e){var i=20;switch(e){case 0:i*=1;break;case 1:i*=1.2;break;case 2:i*=1.5}return i},t.getDebuff=function(t,e){var i=[];switch(t){case 0:i.push({type:0,value:10,time:0});break;case 1:i.push({type:1,value:5,time:2e3});break;case 2:i.push({type:0,value:6,time:0});break;case 3:i.push({type:0,value:4,time:0}),i.push({type:2,value:.6,time:2e3});break;case 4:i.push({type:0,value:10,time:0});break;case 5:break;case 6:i.push({type:0,value:4,time:0})}return i},t.getVelocity=function(t,e){var i=5;switch(t){case 0:i=5;break;case 1:i=4;break;case 2:i=0;break;case 3:i=4;break;case 4:i=.8;break;case 5:i=4;break;case 6:i=0}switch(e){case 0:i*=1;break;case 1:i*=1.1;break;case 2:i*=1.2}return i},t.getCD=function(t,e){var i=500;switch(t){case 0:i=500;break;case 1:i=1e3;break;case 2:i=1500;break;case 3:i=1e3;break;case 4:i=1e3;break;case 5:i=1e3}switch(e){case 0:i*=1;break;case 1:i*=.8;break;case 2:i*=.6}return i},t}();t.Bullet=e,__reflect(e.prototype,"game.Bullet")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t}();t.Debuff=e,__reflect(e.prototype,"game.Debuff")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t.getSpeed=function(t){var e=1;switch(t){case 0:e=.5;break;case 1:e=.8}return e/60},t.getHP=function(t){var e=100;switch(t){case 0:e=120;break;case 1:e=80}return e},t.getArea=function(t){var e=10;switch(t){case 0:e=12;break;case 1:e=8}return e},t}();t.Enemy=e,__reflect(e.prototype,"game.Enemy")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t.CreateBullet="CreateBullet",t.EnemyClear="EnemyClear",t.TowerSold="TowerSold",t}();t.GameEvent=e,__reflect(e.prototype,"game.GameEvent")}(game||(game={}));var game;!function(t){var e=function(){function t(){}return t.BGUI={name:"BgUI",hierarchy:0},t.HOMEUI={name:"HomeUI",hierarchy:1},t.GAMEUI={name:"GameUI",hierarchy:1},t.EDITUI={name:"EditUI",hierarchy:1},t.LOGINUI={name:"LoginUI",hierarchy:1},t
}();t.Scenes=e,__reflect(e.prototype,"game.Scenes");var i=function(){function t(){}return t}();t.SceneUI=i,__reflect(i.prototype,"game.SceneUI")}(game||(game={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,a){function n(t){e.call(a,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(a))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(a,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var game;!function(t){var e=function(){function t(){}return t.HttpServerPath="http://127.0.0.1:7001",t.WebSocketServerPath="http://127.0.0.1:7001",t.skin="",t.size=115,t}();t.GlobalData=e,__reflect(e.prototype,"game.GlobalData")}(game||(game={}));var game;!function(t){var e=function(){function e(){this.uiList=[],this.container=new egret.DisplayObjectContainer,this.container.width=1080,this.container.height=1920,this.container.x=0,this.container.y=0,this.loadingUI=new LoadingUI,this.loadingUI.visible=!1,this.init()}return e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.addToStage=function(t){t.addChild(this.container),t.addChild(this.loadingUI)},e.prototype.init=function(){for(var t=0;5>t;t++){var e=new egret.DisplayObjectContainer;e=new egret.DisplayObjectContainer,e.width=1920,e.height=1080,e.x=0,e.y=0,e.scaleX=this.container.scaleX,e.scaleY=this.container.scaleY,this["container"+t]=e,this.container.addChild(e)}},e.prototype.initUIScene=function(e,i){var a=this["container"+e.hierarchy];1===e.hierarchy&&a.removeChildren();var n;e.data=i,n=new t[""+e.name](e),n&&(n.name=e.name,a.addChild(n))},e.prototype.closeUIscene=function(t){var e=(t.name,this["container"+t.hierarchy]),i=e.getChildByName(t.name);e.removeChild(i)},e}();t.ScenesManager=e,__reflect(e.prototype,"game.ScenesManager")}(game||(game={}));var game;!function(t){var e=function(){function t(){this.speed=1,this._tickers=[]}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=1===t?1:2},enumerable:!0,configurable:!0}),t.prototype.getTicker=function(t){for(var e=this._tickers.length-1;e>=0;e--)if(this._tickers[e].ticker.hash===t)return this._tickers[e].ticker;return null},t.prototype.addTicker=function(t,e){for(var i=this._tickers.length-1;i>=0;i--)if(this._tickers[i].ticker.hash===t.hash)return;this._tickers.push({ticker:t,priority:e})},t.prototype.removeTicker=function(t){for(var e=this._tickers.length-1;e>=0;e--)if(this._tickers[e].ticker.hash===t)return void this._tickers.splice(e,1)},t.prototype.removeAllTickers=function(){this._tickers=[]},t.prototype.startTick=function(){this._tickers.sort(function(t,e){return t.priority-e.priority}),egret.startTick(this.tick,this)},t.prototype.stopTick=function(){egret.stopTick(this.tick,this)},t.prototype.tick=function(t){for(var e=0;e<this.speed;e++)this._tickers.forEach(function(e,i){e.ticker.update(t)});return!1},t}();t.TickManager=e,__reflect(e.prototype,"game.TickManager")}(game||(game={}));var game;!function(t){var e=function(){function e(){this._items=[]}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getItem=function(e){var i=null;if(this._items[e]||(this._items[e]=[]),this._items[e].length>0)i=this._items[e].pop();else switch(e){case 0:i=new t.Bullet_0;break;case 1:i=new t.Bullet_1;break;case 2:i=new t.Bullet_2;break;case 3:i=new t.Bullet_3;break;case 4:i=new t.Bullet_4;break;case 5:i=new t.Bullet_5;break;case 6:i=new t.Bullet_5_Splash}return i},e.prototype.storeItem=function(t){t.clear(),t.hash=com.StringUtil.getUUID(),this._items[t.type]||(this._items[t.type]=[]),this._items[t.type].push(t)},e.prototype.clear=function(){this._items=null},e}();t.BulletPool=e,__reflect(e.prototype,"game.BulletPool",["game.IPool"])}(game||(game={}));var game;!function(t){var e=function(){function e(){this._items=[]}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getItem=function(e){var i=null;if(this._items[e]||(this._items[e]=[]),this._items[e].length>0)i=this._items[e].pop();else switch(e){case 0:i=new t.Enemy_0;break;case 1:i=new t.Enemy_1}return i},e.prototype.storeItem=function(t){t.clear(),t.hash=com.StringUtil.getUUID(),this._items[t.type]||(this._items[t.type]=[]),this._items[t.type].push(t)},e.prototype.clear=function(){this._items=null},e}();t.EnemyPool=e,__reflect(e.prototype,"game.EnemyPool",["game.IPool"])}(game||(game={}));var game;!function(t){var e=function(){function e(){this._items=[]}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getItem=function(){var e=null;return e=this._items.length>0?this._items.pop():new t.HPBar},e.prototype.storeItem=function(t){t.clear(),this._items.push(t)},e.prototype.clear=function(){this._items.forEach(function(t){t.clear()}),this._items=[]},e}();t.HPBarPool=e,__reflect(e.prototype,"game.HPBarPool",["game.IPool"])}(game||(game={}));var game;!function(t){var e=function(){function e(){this._items=[]}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getItem=function(e){var i=null;if(this._items[e]||(this._items[e]=[]),this._items[e].length>0)i=this._items[e].pop();else switch(e){case 0:i=new t.Tower_0;break;case 1:i=new t.Tower_1;break;case 2:i=new t.Tower_2;break;case 3:i=new t.Tower_3;break;case 4:i=new t.Tower_4;break;case 5:i=new t.Tower_5}return i},e.prototype.storeItem=function(t){t.clear(),t.hash=com.StringUtil.getUUID(),this._items[t.type]||(this._items[t.type]=[]),this._items[t.type].push(t)},e.prototype.clear=function(){this._items=null},e}();t.TowerPool=e,__reflect(e.prototype,"game.TowerPool",["game.IPool"])}(game||(game={}));var com;!function(t){var e=function(){function t(){}return t.send=function(t){var e=this;return new Promise(function(i,a){var n=new egret.HttpRequest,r="";n.once(egret.Event.COMPLETE,function(){i()},e),n.once(egret.IOErrorEvent.IO_ERROR,function(){a()},e),t===egret.HttpMethod.GET?(n.open(r,egret.HttpMethod.GET),n.send()):t===egret.HttpMethod.POST&&(n.open(r,egret.HttpMethod.POST),n.send())})},t}();t.Http=e,__reflect(e.prototype,"com.Http")}(com||(com={}));var game;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i.isDrawing=!1,i}return __extends(i,e),i.prototype.initData=function(){this.isDrawing=!1},i.prototype.initUI=function(){for(var t=0;13>t;t++)for(var e=0;7>e;e++){var i=this.groupPath.getChildByName("x"+t+"y"+e);i&&(i.visible=!1)}},i.prototype.initEvent=function(t){t?(this.rectTouchArea.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginDraw,this),this.rectTouchArea.addEventListener(egret.TouchEvent.TOUCH_END,this.cancleDraw,this),this.rectTouchArea.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.cancleDraw,this)):(this.rectTouchArea.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginDraw,this),this.rectTouchArea.removeEventListener(egret.TouchEvent.TOUCH_END,this.cancleDraw,this),this.rectTouchArea.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.cancleDraw,this))},i.prototype.beginDraw=function(e){this.isDrawing=!0;var i=e.localX,a=e.localY,n=Math.floor(i/t.GlobalData.size),r=Math.floor(a/t.GlobalData.size);this.current=[n,r],this.path=[[n,r]],this.showPath(n,r),this.rectTouchArea.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.draw,this)},i.prototype.draw=function(e){if(this.isDrawing){var i=e.localX,a=e.localY,n=Math.floor(i/t.GlobalData.size),r=Math.floor(a/t.GlobalData.size),s=this.path[this.path.length-1];(s[0]!=n||s[1]!=r)&&(this.path.push([n,r]),this.showPath(n,r))}},i.prototype.cancleDraw=function(){this.isDrawing=!1,this.rectTouchArea.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.draw,this),this.checkValid()},i.prototype.checkValid=function(){var t=!0,e="没画好！";this.path.length<3&&(t=!1,e="太短了！");var i=this.path[0],a=this.path[this.path.length-1];i[0]==a[0]&&i[1]==a[1]&&(t=!1,e="起点和终点不能重合！");for(var n=1;n<this.path.length-1;n++){var r=this.path[n];if(i[0]==r[0]&&i[1]==r[1]){t=!1,e="路径不能与起点或终点重合！";break}if(a[0]==r[0]&&a[1]==r[1]){t=!1,e="路径不能与起点或终点重合！";break}}for(var n=1;n<this.path.length;n++){var s=this.path[n-1],o=this.path[n];s[0]!=o[0]&&s[1]!=o[1]&&(t=!1)}if(t)this.openGameUI();else{alert(e),this.path=[],this.current=[];for(var n=0;13>n;n++)for(var h=0;7>h;h++){var l=this.groupPath.getChildByName("x"+n+"y"+h);l&&(l.visible=!1)}}},i.prototype.openGameUI=function(){var e={skin:"alien",width:13,height:7,path:[[0,0],[2,0],[2,4],[10,4],[10,2],[12,2]],tower:[0,1,2],enemy:[0,1],round:30,money:1e4,enemyNum:5,defaultTower:[{type:0,level:1,pos:[3,3]},{type:5,level:1,pos:[4,3]},{type:4,level:0,pos:[5,3]},{type:1,level:0,pos:[6,3]},{type:2,level:0,pos:[7,3]},{type:3,level:2,pos:[11,3]}]};e.path=this.path,e.defaultTower=[],t.ScenesManager.getInstance().initUIScene(t.Scenes.GAMEUI,e)},i.prototype.showPath=function(t,e){var i=this.groupPath.getChildByName("x"+t+"y"+e);i&&(i.visible=!0)},i.prototype.dispose=function(){e.prototype.dispose.call(this)},i}(t.BaseScene);t.EditUI=e,__reflect(e.prototype,"game.EditUI")}(game||(game={}));var game;!function(t){var e=function(e){function i(t){return e.call(this,t)||this}return __extends(i,e),i.prototype.initData=function(){},i.prototype.initUI=function(){this.lv=new t.Level(this.data),this.groupLevel.addChild(this.lv),this.rectStart.visible=!0,this.labelStart.visible=!0},i.prototype.initEvent=function(t){t?this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.handleTap,this):this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.handleTap,this)},i.prototype.handleTap=function(e){switch(e.target){case this.btnPause:t.TickManager.getInstance().stopTick(),this.rectStart.visible=!0,this.labelStart.visible=!0;break;case this.switchSpeed:t.TickManager.getInstance().speed=this.switchSpeed.selected?2:1;break;case this.rectStart:this.rectStart.visible=!1,this.labelStart.visible=!1,t.TickManager.getInstance().startTick();break;case this.btnClear:this.lv.clearAllEnemy();break;case this.btnFreeze:this.lv.freezeAllEnemy()}},i.prototype.dispose=function(){e.prototype.dispose.call(this)},i}(t.BaseScene);t.GameUI=e,__reflect(e.prototype,"game.GameUI")}(game||(game={}));